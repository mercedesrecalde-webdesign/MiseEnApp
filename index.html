
<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>#RecetasEnUnaPagina - Mercedes Recalde</title>
    <meta name="description" content="Tu acceso directo a la cocina sin secretos y paso a paso">
    <meta name="theme-color" content="#ea580c">

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.21.0/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&family=Playfair+Display:ital,wght@1,900&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #fffaf5;
        }

        .font-brand {
            font-family: 'Inter', sans-serif;
            font-weight: 900;
        }

        .font-serif-italic {
            font-family: 'Playfair Display', serif;
            font-style: italic;
            font-weight: 900;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-in {
            animation: fadeIn 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }

        /* Efecto de Blanco y Negro a Color */
        .photo-hover-effect {
            filter: grayscale(100%);
            transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .photo-hover-effect:hover {
            filter: grayscale(0%);
            transform: scale(1.03);
        }

        .bg-pattern {
            background-image: radial-gradient(#fb923c 0.6px, transparent 0.6px);
            background-size: 30px 30px;
            opacity: 0.08;
        }

        .text-stroke {
            -webkit-text-stroke: 1px #ea580c;
            color: transparent;
        }

        /* DISE√ëO ART√çSTICO DEL LOGO */
        .logo-container {
            display: inline-block;
            line-height: 0.75;
        }

        .text-pagina {
            color: #ea580c;
            /* Color naranja para Pagina */
        }

        /* ESTILOS DE IMPRESI√ìN - V9 (FINAL + BRANDING) */
        @media print {
            @page {
                size: A4;
                margin: 0.5cm;
            }

            /* 1. PADRES VISIBLES */
            body,
            html,
            #root,
            .min-h-screen {
                visibility: visible !important;
                overflow: visible !important;
                height: auto !important;
                width: 100% !important;
                display: block !important;
                background: white !important;
                position: static !important;
            }

            /* 2. OCULTAR HERMANOS */
            nav,
            header,
            main,
            footer,
            .bg-pattern,
            .fixed.bottom-4,
            #search-section,
            .cursor-pointer,
            button,
            a[href*="wa.me"],
            a[href*="cafecito"],
            .print\:hidden {
                display: none !important;
            }

            /* 3. MODAL: POSICIONAMIENTO ABSOLUTO */
            .fixed.inset-0.z-\[60\] {
                position: absolute !important;
                inset: 0 !important;
                top: 0 !important;
                left: 0 !important;
                right: 0 !important;
                width: 100% !important;
                height: auto !important;
                z-index: 9999 !important;
                background: white !important;
                display: block !important;
                visibility: visible !important;
            }

            /* Contenedor interno (Card) */
            .fixed.inset-0.z-\[60\]>div {
                position: relative !important;
                width: 100% !important;
                max-width: none !important;
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                background: white !important;
            }

            /* BRANDING FOOTER (La firma de Mercedes) */
            /* Agregamos esto al final del contenedor de la tarjeta */
            .fixed.inset-0.z-\[60\]>div::after {
                content: "Receta de www.recetasenunapagina.com ¬∑ Mercedes Recalde";
                display: block !important;
                text-align: center !important;
                font-size: 9pt !important;
                color: #ea580c !important;
                /* Orange-600 */
                font-weight: bold !important;
                margin-top: 20px !important;
                padding-top: 10px !important;
                border-top: 1px solid #fed7aa !important;
                /* Orange-200 */
                width: 100% !important;
                page-break-inside: avoid !important;
            }

            /* Bot√≥n cerrar */
            .fixed.inset-0.z-\[60\] button {
                display: none !important;
            }

            /* 4. CONTENIDO: AJUSTE DE ANCHO */
            .fixed.inset-0.z-\[60\] .overflow-y-auto {
                overflow: visible !important;
                width: 100% !important;
                padding-right: 15px !important;
            }

            /* Header */
            .fixed.inset-0.z-\[60\] .relative.print\:flex {
                display: flex !important;
                align-items: center !important;
                gap: 20px !important;
                border-bottom: 2px solid #ea580c !important;
                padding-bottom: 10px !important;
                margin-bottom: 20px !important;
            }

            .fixed.inset-0.z-\[60\] img {
                width: 90px !important;
                height: 90px !important;
                border-radius: 50% !important;
                object-fit: cover !important;
            }

            .fixed.inset-0.z-\[60\] h2 {
                font-size: 20pt !important;
                color: #ea580c !important;
                margin: 0 !important;
            }

            .absolute.inset-0.bg-gradient-to-t {
                display: none !important;
            }

            /* 5. GRID FLEXIBLE */
            .mx-4.md\:mx-8.my-6.bg-white {
                display: grid !important;
                grid-template-columns: 35% 62% !important;
                gap: 3% !important;
                margin: 0 !important;
                padding: 0 !important;
                border: none !important;
                box-shadow: none !important;
                width: 100% !important;
            }

            /* Columnas */
            .mx-4 .p-6:first-child {
                padding: 0 !important;
                border-right: 1px solid #eee !important;
                padding-right: 10px !important;
            }

            .mx-4 .p-6:last-child {
                padding: 0 !important;
            }

            /* Anti-Break */
            h3,
            li,
            p {
                page-break-inside: avoid;
                break-inside: avoid;
            }

            /* Tipograf√≠a */
            h3 {
                font-size: 12pt !important;
                color: #ea580c !important;
                border-bottom: 1px solid #ea580c !important;
                margin-bottom: 8px !important;
                display: inline-block !important;
            }

            ul li,
            ol li,
            p {
                font-size: 9pt !important;
                color: black !important;
                line-height: 1.35 !important;
                margin-bottom: 4px !important;
            }

            /* Clean */
            .w-10.h-10,
            .flex-1.h-0\.5,
            .h-px {
                display: none !important;
            }

            .bg-white.border-b.border-orange-100 {
                padding: 0 !important;
                border: none !important;
                margin-bottom: 5px !important;
            }

            .flex.items-center.gap-4 {
                display: block !important;
                margin-bottom: 5px !important;
            }

            footer {
                display: none !important;
            }
        }
    </style>

    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js'
        data-cf-beacon='{"token": "REEMPLAZAR_CON_TU_TOKEN"}'></script>
    <!-- Instrucciones: Despu√©s del deploy, ir a Cloudflare Dashboard ‚Üí Web Analytics ‚Üí Sites ‚Üí Copiar el token y reemplazarlo arriba -->
</head>

<body class="text-gray-800">
    <div id="root"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- SUPABASE CONFIG ---
        const SUPABASE_URL = 'https://dukgjrhyhyxvdqzhthje.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR1a2dqcmh5aHl4dmRxemh0aGplIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc5MTQzNjIsImV4cCI6MjA4MzQ5MDM2Mn0.JYZWv2vYwMbTopyL-T8_kjbX2py5IL7Ap6ASZc2B4dM';
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // --- DATABASE ---
        const DB_KEY = 'recetasenunpagina_data';
        const CONTENT_ID = 'recetas_main';
        
        // Detectar iOS/Safari
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                      (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isIOSorSafari = isIOS || isSafari;
        
        if (isIOSorSafari) {
            console.log('üçé iOS/Safari detectado - usando modo especial');
        }

        // FIX iOS: Funci√≥n segura para guardar en localStorage (evita QuotaExceededError)
        const safeSaveToStorage = (key, data) => {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.log('‚ö†Ô∏è localStorage no disponible o lleno, usando solo memoria');
                return false;
            }
        };

        // FIX iOS: Funci√≥n segura para leer de localStorage
        const safeGetFromStorage = (key) => {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            } catch (e) {
                console.log('‚ö†Ô∏è Error leyendo localStorage');
                return null;
            }
        };

        const defaultData = {
            bio: {
                title: "Mucho m√°s que una receta.",
                content: "Soy Mercedes Recalde, Tecnica Superior en Gastronom√≠a y Docente certificada. Mi vida profesional se resume en una misi√≥n: democratizar la t√©cnica gastron√≥mica.\n\nA trav√©s de @MerBakes y @Schoolinarymer, comparto el rigor de la pasteler√≠a profesional adaptado al hogar. Este archivo digital es el punto de encuentro de todo mi contenido t√©cnico.",
                photo: "Mer-3155.jpg"
            },
            galleryPhotos: [
                "Mer-3103.jpg",
                "Mer-3140.jpg",
                "Mer-3098.jpg",
                "Mer-3131.jpg",
                "Mer-3110.jpg",
                "Mer-3157.jpg",
                "Mer-3151.jpg"
            ],
            recipes: [],
            newsletters: [],
            techniques: [],
            contact: {
                email: "sugarybs@gmail.com",
                instagram: "https://instagram.com/Schoolinarymer",
                twitter: "https://x.com/MerBakes"
            }
        };

        // Cargar desde localStorage primero (ya deber√≠a tener datos)
        const getLocalData = () => {
            const parsed = safeGetFromStorage(DB_KEY);
            if (parsed && parsed.recipes && parsed.recipes.length > 0) {
                return parsed;
            }
            return null;
        };

        // Load data from Supabase with localStorage fallback
        // FIX SAFARI/iOS v4: Worker proxy PRIMERO para iOS
        const WORKER_PROXY_URL = 'https://recetas-api.mercedes-recalde.workers.dev';
        
        const loadDataFromSupabase = async () => {
            const TIMEOUT_MS = 8000;

            // EN iOS/Safari: Limpiar localStorage viejo y cargar SOLO del Worker
            if (isIOSorSafari) {
                console.log('üçé iOS: Cargando exclusivamente del Worker...');
                try {
                    const response = await fetch(WORKER_PROXY_URL);
                    if (response.ok) {
                        const result = await response.json();
                        if (result && result.recipes && result.recipes.length > 0) {
                            safeSaveToStorage(DB_KEY, result);
                            console.log('‚úÖ iOS: Datos cargados via Worker! Recetas:', result.recipes.length);
                            return result;
                        }
                    }
                } catch (err) {
                    console.log('‚ùå iOS Worker fall√≥:', err.message);
                }
                // Si Worker falla en iOS, devolver defaultData (NO localStorage viejo)
                return defaultData;
            }

            // Para PC/Android: usar el m√©todo normal con Supabase
            try {
                const { data, error } = await supabase
                    .from('recetas_content')
                    .select('content')
                    .eq('id', CONTENT_ID)
                    .single();

                if (!error && data && data.content) {
                    safeSaveToStorage(DB_KEY, data.content);
                    console.log('‚úÖ Datos cargados con cliente Supabase');
                    return data.content;
                }
            } catch (err) {
                console.log('‚ö†Ô∏è Cliente Supabase fall√≥:', err.message);
            }

            // Fallback: localStorage o defaultData
            const localData = safeGetFromStorage(DB_KEY);
            return localData || defaultData;
        };

        const getData = () => {
            const parsed = safeGetFromStorage(DB_KEY);
            if (!parsed) return defaultData;
            // MIGRATION V3: Ensure techniques exists
            if (!parsed.techniques) {
                parsed.techniques = [];
            }
            return parsed;
        };

        const saveData = (data) => safeSaveToStorage(DB_KEY, data);

        // Verificar si un contenido est√° publicado (fecha <= hoy)
        const isPublished = (item) => {
            if (!item.date) return true; // Si no tiene fecha, est√° publicado
            const publishDate = new Date(item.date);
            const today = new Date();
            today.setHours(23, 59, 59, 999); // Fin del d√≠a
            return publishDate <= today;
        };

        // Initialize with localStorage first (fast), then sync from Supabase

        // --- COMPONENTES DE ICONOS ---
        const XSocialIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z" />
            </svg>
        );

        const InstagramIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
            </svg>
        );

        const CafecitoIcon = ({ size = 20, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="currentColor" className={className}>
                <path d="M2 21h18v-2H2m18-2H6V7h14m0-2H4v10a4 4 0 0 0 4 4h10a4 4 0 0 0 4-4m-2.5-6.5a1 1 0 0 1-1 1A1.5 1.5 0 0 1 17 8a1 1 0 0 1 1-1 1.5 1.5 0 0 1 1.5 1.5M5 3h14V1H5z" />
            </svg>
        );

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconRef = React.useRef(null);

            React.useEffect(() => {
                if (iconRef.current && window.lucide) {
                    // Limpiar el contenedor
                    iconRef.current.innerHTML = '';
                    // Crear el icono usando Lucide
                    const iconName = name.replace(/([A-Z])/g, '-$1').toLowerCase().replace(/^-/, '');
                    iconRef.current.innerHTML = `<i data-lucide="${iconName}"></i>`;
                    window.lucide.createIcons({ nodes: [iconRef.current] });

                    // Aplicar estilos al SVG generado
                    const svg = iconRef.current.querySelector('svg');
                    if (svg) {
                        svg.setAttribute('width', size);
                        svg.setAttribute('height', size);
                        if (className) {
                            className.split(' ').forEach(cls => svg.classList.add(cls));
                        }
                    }
                }
            }, [name, size, className]);

            return <span ref={iconRef} className="inline-flex items-center justify-center" style={{ width: size, height: size }}></span>;
        };

        const Toast = ({ message, onClose }) => (
            <div className="fixed top-24 right-6 z-[80] animate-in">
                <div className="bg-white/90 backdrop-blur-md border border-orange-200 shadow-2xl rounded-2xl p-4 flex items-center gap-4 max-w-sm">
                    <div className="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 shrink-0">
                        <Icon name="Bell" size={20} />
                    </div>
                    <div className="flex-1">
                        <h4 className="font-bold text-gray-900 text-sm">¬°Nueva Publicaci√≥n!</h4>
                        <p className="text-xs text-gray-500 line-clamp-1">{message}</p>
                    </div>
                    <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                        <Icon name="X" size={16} />
                    </button>
                </div>
            </div>
        );

        const NewsletterModal = ({ newsletter, onClose }) => (
            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-gray-950/95 backdrop-blur-xl animate-in">
                <div className="bg-[#fffaf5] w-full max-w-4xl max-h-[92vh] rounded-[3rem] overflow-y-auto relative shadow-2xl border-4 border-white/20 no-scrollbar">
                    <button onClick={onClose} className="absolute top-6 right-6 z-10 p-3 bg-white/90 hover:bg-orange-500 hover:text-white rounded-full shadow-xl transition-all hover:rotate-90">
                        <Icon name="X" size={24} />
                    </button>

                    {/* Header */}
                    <div className="relative h-auto min-h-[280px] md:min-h-[350px] bg-gradient-to-br from-orange-100 to-orange-50">
                        <img src={newsletter.image || newsletter.coverImage} className="w-full h-auto max-h-[400px] object-contain mx-auto" alt={newsletter.title} />
                        <div className="absolute inset-0 bg-gradient-to-t from-gray-900/90 via-gray-900/20 to-transparent"></div>
                        <div className="absolute bottom-0 left-0 w-full p-8 md:p-12 text-white">
                            <span className="bg-orange-500 text-white px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-[0.2em] mb-4 inline-block shadow-lg">Newsletter</span>
                            <h2 className="text-3xl md:text-5xl font-brand leading-tight mb-4">{newsletter.title}</h2>
                            <p className="text-gray-200 text-sm md:text-base font-medium max-w-2xl">{newsletter.subtitle}</p>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="p-8 md:p-12 space-y-10 max-w-3xl mx-auto">
                        <div className="flex items-center gap-4 text-xs font-bold uppercase tracking-widest text-gray-400 border-b border-orange-100 pb-8">
                            <span className="flex items-center gap-2"><Icon name="Calendar" size={14} /> {new Date(newsletter.date).toLocaleDateString('es-AR', { day: 'numeric', month: 'long' })}</span>
                            <span className="w-1 h-1 rounded-full bg-orange-300"></span>
                            <span className="flex items-center gap-2"><Icon name="Clock" size={14} /> {newsletter.readingTime || '5 min'} lectura</span>
                        </div>

                        <div className="prose prose-orange prose-lg">
                            {(newsletter.sections || []).map((section, idx) => {
                                if (section.type === 'text') {
                                    return <p key={idx} className="text-gray-600 leading-relaxed text-lg" dangerouslySetInnerHTML={{ __html: section.content.replace(/\n/g, '<br/>') }}></p>;
                                } else if (section.type === 'image') {
                                    return (
                                        <div key={idx} className="my-8 rounded-2xl overflow-hidden shadow-lg">
                                            <img src={section.content} alt="Ilustraci√≥n" className="w-full" />
                                            {section.caption && <p className="text-center text-sm text-gray-400 mt-2 italic">{section.caption}</p>}
                                        </div>
                                    );
                                } else if (section.type === 'tip') {
                                    return (
                                        <div key={idx} className="bg-orange-50 p-6 md:p-8 rounded-3xl border border-orange-100 my-8">
                                            <div className="flex items-center gap-3 text-orange-600 mb-4">
                                                <span className="text-2xl">{section.icon || 'üí°'}</span>
                                            </div>
                                            <p className="text-gray-700 font-medium italic text-lg" dangerouslySetInnerHTML={{ __html: section.content.replace(/\n/g, '<br/>') }}></p>
                                        </div>
                                    );
                                } else if (section.type === 'subtitle') {
                                    return <h3 key={idx} className="text-2xl font-brand text-gray-900 mt-8 mb-4">{section.content}</h3>;
                                }
                                return null;
                            })}
                        </div>

                        {/* Footer / Share */}
                        <div className="pt-12 border-t border-orange-100 text-center">
                            <p className="text-sm font-medium text-gray-500 mb-6">¬øTe gust√≥ este newsletter?</p>
                            <a
                                href={`https://wa.me/?text=¬°Mir√° este contenido de #RecetasEnUnaPagina! ${encodeURIComponent(window.location.href)}`}
                                target="_blank"
                                className="inline-flex items-center gap-2 bg-green-500 text-white px-6 py-3 rounded-full font-bold text-xs uppercase tracking-widest hover:bg-green-600 transition-all shadow-lg hover:-translate-y-1"
                            >
                                <Icon name="Share2" size={16} /> Compartir por WhatsApp
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        );

        const TechniqueModal = ({ technique, onClose }) => (
            <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-gray-950/95 backdrop-blur-xl animate-in">
                <div className="bg-black w-full max-w-5xl rounded-3xl overflow-hidden relative shadow-2xl border border-gray-800 flex flex-col max-h-[90vh]">
                    <button onClick={onClose} className="absolute top-4 right-4 z-20 p-2 bg-black/50 hover:bg-white/20 text-white rounded-full transition-all">
                        <Icon name="X" size={24} />
                    </button>

                    <div className="flex-1 bg-black flex items-center justify-center relative">
                        {technique.type === 'video' ? (
                            <div className="w-full aspect-video">
                                <iframe
                                    src={technique.url}
                                    className="w-full h-full"
                                    frameBorder="0"
                                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                                    allowFullScreen
                                ></iframe>
                            </div>
                        ) : (
                            <img src={technique.url} className="w-full h-full object-contain max-h-[70vh]" alt={technique.title} />
                        )}
                    </div>

                    <div className="p-6 md:p-8 bg-gray-900 text-white">
                        <div className="flex items-center gap-3 mb-2">
                            <span className="bg-purple-600 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">Academy</span>
                            <h2 className="text-xl md:text-2xl font-brand">{technique.title}</h2>
                        </div>
                        <p className="text-gray-400 text-sm md:text-base">{technique.description}</p>
                    </div>
                </div>
            </div>
        );

        const CATEGORIES = ["Todos", "Panader√≠a", "Pasteler√≠a", "Recetas veganas", "Recetas sin gluten", "Recetas keto", "Newsletters"];

        function App() {
            // En iOS: empezar con defaultData (vac√≠o), NO localStorage viejo
            const [data, setData] = useState(isIOSorSafari ? defaultData : getData());
            const [isCloudData, setIsCloudData] = useState(false);
            const [isLoading, setIsLoading] = useState(true);
            const [view, setView] = useState("recipes");
            const [activeCategory, setActiveCategory] = useState("Todos");
            const [searchQuery, setSearchQuery] = useState("");
            const [selectedRecipe, setSelectedRecipe] = useState(null);
            const [selectedNewsletter, setSelectedNewsletter] = useState(null);
            const [selectedTechnique, setSelectedTechnique] = useState(null);
            const [showContact, setShowContact] = useState(false);
            const [showToast, setShowToast] = useState(false);
            const [toastMessage, setToastMessage] = useState("");

            const handleManualRefresh = async () => {
                setIsLoading(true);
                try {
                    const cloudData = await loadDataFromSupabase();
                    if (cloudData && cloudData.recipes) {
                        setData(cloudData);
                        setIsCloudData(true);
                        console.log('üîÑ Refresco manual exitoso');
                    }
                } catch (e) {
                    console.error('Error en refresco manual:', e);
                } finally {
                    setIsLoading(false);
                }
            };


            // Load data from Supabase on mount and subscribe to real-time updates
            useEffect(() => {
                // Initial load from Supabase/Worker
                loadDataFromSupabase().then(cloudData => {
                    setIsLoading(false);
                    if (cloudData && cloudData.recipes && cloudData.recipes.length > 0) {
                        setData(cloudData);
                        setIsCloudData(true);
                        console.log('‚úÖ Datos sincronizados con la nube');
                    } else {
                        console.log('‚ö†Ô∏è Sin datos en nube o vac√≠os');
                        if (!isIOSorSafari) {
                            setData(getData());
                        }
                        setIsCloudData(false);
                    }
                }).catch(err => {
                    setIsLoading(false);
                    console.error('Error cargando datos:', err);
                    if (!isIOSorSafari) {
                        setData(getData());
                    }
                    setIsCloudData(false);
                });

                // Subscribe to real-time changes - SOLO en PC/Android (causa problemas en iOS)
                let channel = null;
                if (!isIOSorSafari) {
                    channel = supabase
                        .channel('recetas_changes')
                        .on('postgres_changes',
                            { event: '*', schema: 'public', table: 'recetas_content', filter: `id=eq.${CONTENT_ID}` },
                            (payload) => {
                                console.log('üì° Actualizaci√≥n en tiempo real recibida!');
                                if (payload.new && payload.new.content) {
                                    const newData = payload.new.content;
                                    safeSaveToStorage(DB_KEY, newData);
                                    setData(newData);
                                }
                            }
                        )
                        .subscribe();
                } else {
                    console.log('üçé iOS: Real-time desactivado');
                }

                return () => {
                    if (channel) {
                        supabase.removeChannel(channel);
                    }
                };
            }, []);

            useEffect(() => {
                // Check for new releases - SOLO contenido PUBLICADO (fecha <= hoy)
                const checkNewcontent = () => {
                    // Filtrar solo contenido publicado
                    const publishedContent = [
                        ...data.recipes.filter(r => isPublished(r)),
                        ...data.newsletters.filter(n => isPublished(n))
                    ];
                    if (publishedContent.length === 0) return;

                    const latest = publishedContent.reduce((a, b) => new Date(a.date) > new Date(b.date) ? a : b);
                    const lastSeenDate = localStorage.getItem('last_seen_date');

                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

                    if (new Date(latest.date) > oneWeekAgo && (!lastSeenDate || new Date(latest.date) > new Date(lastSeenDate))) {
                        setToastMessage(`"${latest.title}" ya est√° disponible.`);
                        setShowToast(true);
                        // Update last seen after showing
                        setTimeout(() => {
                            localStorage.setItem('last_seen_date', new Date().toISOString());
                        }, 2000);
                    }
                };

                // Small delay to show toast
                setTimeout(checkNewcontent, 1500);
            }, [data]);

            const hasNewContent = useMemo(() => {
                const oneWeekAgo = new Date();
                oneWeekAgo.setDate(oneWeekAgo.getDate() - 7);

                // Solo considerar contenido PUBLICADO (fecha <= hoy) como "nuevo"
                const recentRecipes = data.recipes.some(r => isPublished(r) && new Date(r.date) > oneWeekAgo);
                const recentNewsletters = data.newsletters.some(n => isPublished(n) && new Date(n.date) > oneWeekAgo);

                return { recipes: recentRecipes, newsletters: recentNewsletters };
            }, [data]);

            const allContent = useMemo(() => {
                const recipes = data.recipes.map(r => ({ ...r, type: 'receta' }));
                const newsletters = data.newsletters.map(n => ({ ...n, type: 'newsletter' }));
                return [...recipes, ...newsletters];
            }, [data]);

            const newReleases = useMemo(() => {
                // Solo mostrar recetas PUBLICADAS en "√öltimos Lanzamientos", no newsletters
                return data.recipes
                    .filter(r => isPublished(r)) // Solo recetas cuya fecha ya pas√≥
                    .map(r => ({ ...r, type: 'receta' }))
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 3);
            }, [data.recipes]);

            const filteredRecipes = useMemo(() => {
                // Filtrar solo contenido publicado (fecha <= hoy)
                const recipes = data.recipes
                    .filter(r => isPublished(r))
                    .map(r => ({ ...r, type: 'receta' }));
                const newsletters = data.newsletters
                    .filter(n => isPublished(n))
                    .map(n => ({ ...n, type: 'newsletter', category: 'Newsletters' }));

                // Si la categor√≠a es "Newsletters", mostrar solo newsletters
                // Si es "Todos" u otra categor√≠a, mostrar solo recetas (no mezclar)
                if (activeCategory === "Newsletters") {
                    return newsletters.filter(item =>
                        item.title.toLowerCase().includes(searchQuery.toLowerCase())
                    ).sort((a, b) => new Date(b.date) - new Date(a.date));
                }

                // Para todas las dem√°s categor√≠as, solo recetas
                return recipes.filter(item => {
                    const matchesCategory = activeCategory === "Todos" || (item.category === activeCategory);
                    const matchesSearch = item.title.toLowerCase().includes(searchQuery.toLowerCase());
                    return matchesCategory && matchesSearch;
                }).sort((a, b) => new Date(b.date) - new Date(a.date));
            }, [activeCategory, searchQuery, data]);

            return (
                <div className="min-h-screen pb-12 relative overflow-x-hidden">
                    <div className="absolute inset-0 bg-pattern pointer-events-none"></div>

                    {/* Navbar */}
                    <header className="bg-white/80 backdrop-blur-md border-b border-orange-100 sticky top-0 z-50 shadow-sm">
                        <div className="max-w-7xl mx-auto px-4 md:px-6 py-4 flex justify-between items-center">
                            <div
                                className="flex items-center gap-2 md:gap-3 cursor-pointer group shrink-0"
                                onClick={() => { setView("recipes"); setSelectedRecipe(null); window.scrollTo(0, 0); }}
                            >
                                <div className="bg-orange-600 p-1.5 md:p-2 rounded-xl text-white shadow-lg shadow-orange-200">
                                    <Icon name="ChefHat" size={18} className="md:w-6 md:h-6" />
                                </div>
                                <div className="flex flex-col">
                                    <span className="font-brand text-[14px] md:text-lg tracking-tighter text-gray-900 leading-none">
                                        <span className="md:hidden">#RUP</span>
                                        <span className="hidden md:inline">#RecetasEnUnaPagina</span>
                                    </span>
                                    <span className="text-[8px] md:text-[10px] font-bold uppercase tracking-widest text-orange-600 hidden md:block">Mercedes Recalde</span>
                                </div>
                                <div className="flex items-center gap-2 ml-2">
                                    <div className={`w-2 h-2 rounded-full ${isCloudData ? 'bg-green-500 shadow-[0_0_8px_rgba(34,197,94,0.6)]' : 'bg-gray-300'}`} title={isCloudData ? 'Sincronizado con la nube' : 'Modo Offline / Local'}></div>
                                    <button onClick={handleManualRefresh} className="text-[8px] font-black uppercase tracking-tighter text-gray-400 hover:text-orange-600 transition-colors" title="Forzar carga desde la nube">
                                        {isLoading ? '...' : 'Recargar'}
                                    </button>
                                </div>
                            </div>

                            <div className="flex items-center gap-1.5 md:gap-4 overflow-hidden">
                                <button
                                    onClick={() => { setView("recipes"); setActiveCategory("Newsletters"); setTimeout(() => document.getElementById('search-section')?.scrollIntoView({ behavior: 'smooth' }), 100); }}
                                    className={`px-2.5 md:px-6 py-2 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all relative shrink-0 ${activeCategory === "Newsletters" ? "bg-pink-600 text-white shadow-lg" : "bg-pink-50 text-pink-600 hover:bg-pink-100 border border-pink-200"}`}
                                >
                                    Newsletters
                                    {hasNewContent.newsletters && (
                                        <span className="absolute -top-1 -right-1 flex h-2.5 w-2.5">
                                            <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                            <span className="relative inline-flex rounded-full h-2.5 w-2.5 bg-red-500"></span>
                                        </span>
                                    )}
                                </button>
                                <button
                                    onClick={() => { setView("about"); window.scrollTo(0, 0); }}
                                    className={`px-2.5 md:px-6 py-2 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all shrink-0 ${view === "about" ? "bg-orange-600 text-white shadow-lg" : "bg-orange-50 text-orange-600 hover:bg-orange-100 border border-orange-200"}`}
                                >
                                    Bio
                                </button>
                                <button
                                    onClick={() => setShowContact(true)}
                                    className="px-2.5 md:px-6 py-2 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-widest transition-all bg-pink-50 text-pink-600 hover:bg-pink-600 hover:text-white border border-pink-200 shrink-0"
                                >
                                    Contacto
                                </button>
                                <div className="h-4 w-px bg-orange-200 hidden md:block"></div>
                                <div className="hidden md:flex items-center gap-4">
                                    <a href={data.contact.instagram} target="_blank" className="text-pink-600 hover:scale-110 transition-transform"><InstagramIcon size={20} /></a>
                                    <a href={data.contact.twitter} target="_blank" className="text-blue-600 hover:text-blue-700 hover:scale-110 transition-transform"><XSocialIcon size={18} /></a>
                                    <button onClick={() => setShowContact(true)} className="text-orange-600 hover:text-orange-700 hover:scale-110 transition-transform" title="Contacto">
                                        <Icon name="Mail" size={20} />
                                    </button>
                                </div>
                                {/* Admin link oculto - acceder directamente via /admin.html */}
                            </div>
                        </div>
                        {showToast && <Toast message={toastMessage} onClose={() => setShowToast(false)} />}
                    </header>

                    <main className="max-w-7xl mx-auto px-6 py-12 relative z-10">
                        {view === "about" ? (
                            /* --- VISTA SOBRE M√ç --- */
                            <div className="animate-in space-y-16 md:space-y-24">
                                <section className="flex flex-col lg:flex-row items-center gap-8 md:gap-16 bg-white p-6 md:p-8 lg:p-20 rounded-2xl md:rounded-[3.5rem] shadow-2xl border border-orange-50 relative overflow-hidden">
                                    <div className="w-full lg:w-1/2 space-y-6 md:space-y-10 relative z-10">
                                        <div>
                                            <span className="text-orange-500 text-[10px] md:text-xs font-black uppercase tracking-[0.3em] md:tracking-[0.5em] mb-3 md:mb-4 block underline decoration-orange-200 decoration-2 md:decoration-4 underline-offset-4 md:underline-offset-8">Biograf√≠a Profesional</span>
                                            <h2 className="text-4xl md:text-6xl lg:text-8xl font-brand text-gray-900 leading-[0.85] tracking-tighter">{data.bio.title}</h2>
                                        </div>
                                        <div className="space-y-4 md:space-y-6 text-gray-600 text-sm md:text-base lg:text-lg leading-relaxed border-l-4 md:border-l-8 border-orange-500 pl-4 md:pl-8 font-medium">
                                            {data.bio.content.split('\n\n').map((p, i) => (
                                                <p key={i} dangerouslySetInnerHTML={{ __html: p.replace(/@(\w+)/g, '<strong>@$1</strong>') }}></p>
                                            ))}
                                        </div>
                                        <button onClick={() => setView("recipes")} className="bg-orange-600 text-white px-6 md:px-10 py-4 md:py-5 rounded-2xl md:rounded-3xl font-black uppercase tracking-widest text-[10px] md:text-xs hover:bg-orange-700 transition-all shadow-xl flex items-center gap-2 md:gap-3 group">
                                            Explorar mis Recetas <Icon name="ArrowRight" size={16} className="md:w-5 md:h-5 group-hover:translate-x-2 transition-transform" />
                                        </button>
                                    </div>
                                    <div className="w-full lg:w-1/2 relative">
                                        <div className="absolute -inset-10 bg-orange-100/50 rounded-full blur-3xl opacity-50"></div>
                                        <div className="relative group">
                                            <img src={data.bio.photo} className="relative w-full aspect-[4/5] object-cover rounded-2xl md:rounded-[3rem] shadow-2xl border-4 md:border-8 border-white transition-all duration-700" alt="Mercedes Recalde" />
                                            <div className="absolute -bottom-6 -right-3 md:-bottom-10 md:-right-4 bg-orange-500 text-white p-4 md:p-8 rounded-2xl md:rounded-[2.5rem] shadow-2xl">
                                                <Icon name="Sparkles" size={32} className="md:w-11 md:h-11 animate-pulse" />
                                            </div>
                                        </div>
                                    </div>
                                </section>

                                <section className="space-y-8 md:space-y-12 pb-8 md:pb-12 px-4">
                                    <div className="text-center space-y-3 md:space-y-4">
                                        <h3 className="text-2xl md:text-3xl font-brand text-gray-900 uppercase tracking-tighter">En el Estudio</h3>
                                        <p className="text-sm md:text-base text-gray-500 italic max-w-2xl mx-auto font-medium px-4">Un recorrido visual por mis clases, producciones y el d√≠a a d√≠a entre harinas y t√©cnicas profesionales.</p>
                                    </div>
                                    <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 lg:gap-10">
                                        {data.galleryPhotos[0] && (
                                            <div className="photo-hover-effect overflow-hidden rounded-2xl md:rounded-[3rem] shadow-xl md:col-span-2 md:row-span-2">
                                                <img src={data.galleryPhotos[0]} className="w-full h-full object-cover" alt="Galer√≠a" />
                                            </div>
                                        )}
                                        {data.galleryPhotos.slice(1).map((photo, idx) => (
                                            <div key={idx} className="photo-hover-effect overflow-hidden rounded-xl md:rounded-[2.5rem] shadow-lg aspect-square">
                                                <img src={photo} className="w-full h-full object-cover" alt="Galer√≠a" />
                                            </div>
                                        ))}
                                    </div>
                                </section>
                            </div>
                        ) : (
                            /* --- VISTA DE RECETAS --- */
                            <div className="animate-in">
                                <section className="text-center mb-16 md:mb-24 space-y-8 md:space-y-12 px-4">
                                    <div className="inline-block px-4 md:px-6 py-2 bg-orange-100 rounded-full text-[8px] md:text-[10px] font-black uppercase tracking-[0.3em] md:tracking-[0.5em] text-orange-600 mb-2 md:mb-4 shadow-sm border border-orange-200">
                                        Biblioteca Culinaria Digital
                                    </div>

                                    <div className="logo-container">
                                        <h2 className="text-5xl md:text-7xl lg:text-[12rem] font-brand text-gray-900 leading-[0.75] tracking-tighter mb-6 md:mb-10">
                                            #Recetas<br />
                                            <span className="text-stroke">EnUna</span>
                                            <span className="font-serif-italic text-pagina">
                                                Pagina
                                            </span>
                                        </h2>
                                    </div>

                                    <p className="text-lg md:text-xl lg:text-3xl text-gray-600 max-w-3xl mx-auto font-bold leading-relaxed tracking-tight px-4">
                                        Tu acceso directo a la cocina <br className="hidden md:block" />
                                        <span className="text-orange-600">sin secretos y paso a paso.</span>
                                    </p>
                                    <div className="text-[10px] md:text-xs uppercase tracking-[0.2em] md:tracking-[0.3em] text-gray-400 font-bold px-4">
                                        Por Mercedes Recalde ¬∑ Tecnica Superior en Gastronom√≠a y Docente certificada
                                    </div>
                                </section>

                                {/* NEW RELEASES */}
                                {newReleases.length > 0 && (
                                    <section className="mb-16 md:mb-24 px-4">
                                        <div className="text-center mb-8 md:mb-12">
                                            <h3 className="text-3xl md:text-5xl font-brand text-gray-900 tracking-tighter mb-2 md:mb-4">√öltimos Lanzamientos</h3>
                                            <p className="text-sm md:text-base text-gray-500 italic">Lo m√°s reciente del estudio üî•</p>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 md:gap-8">
                                            {newReleases.map((item, idx) => (
                                                <div
                                                    key={idx}
                                                    className="bg-white rounded-2xl md:rounded-[3rem] overflow-hidden shadow-xl border-2 md:border-4 border-orange-500 relative group cursor-pointer hover:scale-105 transition-all duration-500"
                                                    onClick={() => {
                                                        if (item.type === 'receta') {
                                                            setSelectedRecipe(item);
                                                        } else {
                                                            setSelectedNewsletter(item);
                                                        }
                                                    }}
                                                >
                                                    <div className="absolute top-3 right-3 md:top-6 md:right-6 z-10 bg-orange-600 text-white px-4 md:px-6 py-1.5 md:py-2 rounded-full text-[8px] md:text-[10px] font-black uppercase tracking-widest shadow-lg">
                                                        NUEVO
                                                    </div>
                                                    <div className="h-48 md:h-80 overflow-hidden">
                                                        <img src={item.coverImage || item.image} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000" alt={item.title} />
                                                    </div>
                                                    <div className="p-4 md:p-8">
                                                        <span className="text-orange-500 text-[8px] md:text-[10px] font-black uppercase tracking-[0.2em] md:tracking-[0.3em] block mb-2 md:mb-3">{item.type === 'receta' ? 'üç∞ Receta' : 'üìß Newsletter'}</span>
                                                        <h4 className="text-lg md:text-2xl font-brand text-gray-900 mb-2 md:mb-3 tracking-tight">{item.title}</h4>
                                                        <p className="text-xs md:text-sm text-gray-500 italic">{new Date(item.date).toLocaleDateString('es-AR', { day: 'numeric', month: 'long', year: 'numeric' })}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                )}

                                {/* Academy Section */}
                                {data.techniques && data.techniques.length > 0 && (
                                    <section className="mb-16 md:mb-24 px-4">
                                        <div className="text-center mb-8 md:mb-12">
                                            <div className="inline-flex items-center gap-2 bg-purple-100 text-purple-700 px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest mb-4">
                                                <Icon name="GraduationCap" size={14} /> #RUPAcademy
                                            </div>
                                            <h3 className="text-3xl md:text-5xl font-brand text-gray-900 tracking-tighter mb-2 md:mb-4">Clases & Historias</h3>
                                            <p className="text-sm md:text-base text-gray-500 italic">T√©cnica, cultura y el origen de los sabores</p>
                                        </div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8">
                                            {data.techniques.map((tech) => (
                                                <div
                                                    key={tech.id}
                                                    onClick={() => setSelectedTechnique(tech)}
                                                    className="bg-gray-900 rounded-2xl md:rounded-[2.5rem] overflow-hidden relative cursor-pointer group shadow-2xl hover:-translate-y-2 transition-all duration-500"
                                                >
                                                    <div className="aspect-video relative overflow-hidden">
                                                        <img src={tech.thumbnail} className="w-full h-full object-cover opacity-80 group-hover:opacity-100 group-hover:scale-110 transition-all duration-700" alt={tech.title} />
                                                        <div className="absolute inset-0 bg-black/40 group-hover:bg-transparent transition-colors duration-500"></div>
                                                        <div className="absolute inset-0 flex items-center justify-center">
                                                            <div className="w-12 h-12 md:w-16 md:h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center group-hover:scale-110 transition-transform">
                                                                <Icon name="Play" size={24} className="text-white fill-white" />
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="p-6">
                                                        <h4 className="text-white text-lg md:text-xl font-brand mb-2 leading-tight">{tech.title}</h4>
                                                        <p className="text-gray-400 text-xs md:text-sm line-clamp-2">{tech.description}</p>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    </section>
                                )}

                                {/* Banner Newsletter Destacado - solo si hay newsletters PUBLICADOS */}
                                {data.newsletters.filter(n => isPublished(n)).length > 0 && (
                                    <section className="mb-16 md:mb-24 px-4">
                                        <div
                                            onClick={() => {
                                                const publishedNewsletters = data.newsletters.filter(n => isPublished(n));
                                                const latestNewsletter = publishedNewsletters.sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                                                setSelectedNewsletter(latestNewsletter);
                                            }}
                                            className="bg-gradient-to-r from-teal-500 via-cyan-600 to-teal-600 rounded-2xl md:rounded-[3rem] p-6 md:p-12 cursor-pointer hover:scale-[1.02] transition-all duration-500 shadow-2xl relative overflow-hidden group"
                                        >
                                            <div className="absolute inset-0 bg-white/10 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                            <div className="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"></div>

                                            <div className="relative z-10 flex flex-col md:flex-row items-center gap-6 md:gap-12">
                                                <div className="w-20 h-20 md:w-28 md:h-28 bg-white/20 rounded-2xl md:rounded-3xl flex items-center justify-center shrink-0 backdrop-blur-sm">
                                                    <span className="text-4xl md:text-6xl">üìß</span>
                                                </div>
                                                <div className="flex-1 text-center md:text-left">
                                                    <span className="bg-white/20 text-white px-4 py-1.5 rounded-full text-[9px] md:text-[10px] font-black uppercase tracking-[0.2em] mb-3 md:mb-4 inline-block backdrop-blur-sm">
                                                        üìå √öltimo Newsletter
                                                    </span>
                                                    <h3 className="text-2xl md:text-4xl font-brand text-white mb-2 md:mb-3 tracking-tight">
                                                        {data.newsletters.filter(n => isPublished(n)).sort((a, b) => new Date(b.date) - new Date(a.date))[0]?.title || "Newsletter"}
                                                    </h3>
                                                    <p className="text-white/80 text-sm md:text-base font-medium">
                                                        Contenido exclusivo, tips y novedades del estudio ‚ú®
                                                    </p>
                                                </div>
                                                <div className="w-12 h-12 md:w-16 md:h-16 bg-white rounded-full flex items-center justify-center text-teal-600 group-hover:scale-110 transition-transform shadow-xl shrink-0">
                                                    <Icon name="ArrowRight" size={24} className="md:w-8 md:h-8" />
                                                </div>
                                            </div>
                                        </div>
                                    </section>
                                )}

                                {/* Filtros y Buscador */}
                                <div id="search-section" className="space-y-8 md:space-y-12 mb-16 md:mb-24">
                                    <div className="relative max-w-2xl mx-auto group px-4">
                                        <div className="absolute left-6 md:left-8 top-1/2 -translate-y-1/2 text-gray-300 group-focus-within:text-orange-500 transition-colors">
                                            <Icon name="Search" size={20} className="md:w-8 md:h-8" />
                                        </div>
                                        <input
                                            type="text"
                                            placeholder="¬øQu√© receta busc√°s?"
                                            className="w-full pl-14 md:pl-20 pr-6 md:pr-10 py-4 md:py-7 rounded-full border-2 border-orange-100 focus:outline-none focus:ring-4 md:focus:ring-[12px] focus:ring-orange-500/5 focus:border-orange-300 bg-white shadow-xl md:shadow-2xl transition-all font-medium text-base md:text-xl placeholder:text-gray-300"
                                            value={searchQuery}
                                            onChange={(e) => setSearchQuery(e.target.value)}
                                        />
                                    </div>

                                    <div className="flex flex-wrap justify-center gap-2 md:gap-4 px-4">
                                        {CATEGORIES.map(cat => (
                                            <button
                                                key={cat}
                                                onClick={() => setActiveCategory(cat)}
                                                className={`px-4 md:px-8 py-2.5 md:py-3.5 rounded-full text-[8px] md:text-[10px] font-black uppercase tracking-wider md:tracking-widest transition-all shadow-md relative ${activeCategory === cat
                                                    ? "bg-orange-600 text-white shadow-orange-200 scale-105 md:scale-110"
                                                    : "bg-white text-gray-400 border border-orange-100 hover:bg-orange-50 hover:text-orange-700"
                                                    }`}
                                            >
                                                {cat}
                                                {cat === 'Newsletters' && hasNewContent.newsletters && (
                                                    <span className="absolute -top-1 -right-1 flex h-3 w-3">
                                                        <span className="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                                                        <span className="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
                                                    </span>
                                                )}
                                            </button>
                                        ))}
                                    </div>
                                </div>

                                {/* Rejilla */}
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-12 px-4">
                                    {filteredRecipes.map(item => (
                                        <article
                                            key={item.id + (item.type || 'recipe')}
                                            onClick={() => item.type === 'newsletter' ? setSelectedNewsletter(item) : setSelectedRecipe(item)}
                                            className="bg-white rounded-2xl md:rounded-[3.5rem] overflow-hidden shadow-sm hover:shadow-2xl transition-all duration-500 cursor-pointer group border border-orange-50 flex flex-col h-full"
                                        >
                                            <div className="relative h-56 md:h-80 overflow-hidden">
                                                <img src={item.coverImage || item.image} className="w-full h-full object-cover group-hover:scale-110 transition-transform duration-1000" alt={item.title} />
                                                {item.type === 'newsletter' && (
                                                    <div className="absolute top-4 right-4 bg-white/90 backdrop-blur text-orange-600 px-3 py-1 rounded-full text-[9px] font-black uppercase tracking-widest shadow-sm">
                                                        Newsletter
                                                    </div>
                                                )}
                                            </div>
                                            <div className="p-6 md:p-10 flex flex-col flex-grow">
                                                <span className="text-orange-500 text-[8px] md:text-[10px] font-black uppercase tracking-[0.2em] md:tracking-[0.3em] mb-3 md:mb-4 block">{item.category}</span>
                                                <h3 className="text-xl md:text-3xl font-brand text-gray-900 mb-3 md:mb-4 group-hover:text-orange-600 transition-colors tracking-tighter leading-tight">{item.title}</h3>
                                                <p className="text-gray-500 text-xs md:text-sm line-clamp-2 mb-6 md:mb-8 flex-grow leading-relaxed italic font-medium">"{item.description || item.subtitle}"</p>
                                                <div className="flex items-center justify-between mt-auto pt-6 md:pt-8 border-t border-orange-50">
                                                    <div className="flex items-center gap-4 md:gap-6 text-gray-400 text-[8px] md:text-[10px] font-black uppercase tracking-wider md:tracking-widest">
                                                        {item.type === 'receta' ? (
                                                            <span className="flex items-center gap-1.5 md:gap-2"><Icon name="Clock" size={14} className="md:w-4 md:h-4" /> {item.time}</span>
                                                        ) : (
                                                            <span className="flex items-center gap-1.5 md:gap-2"><Icon name="Calendar" size={14} className="md:w-4 md:h-4" /> {new Date(item.date).toLocaleDateString()}</span>
                                                        )}
                                                    </div>
                                                    <div className="w-10 h-10 md:w-12 md:h-12 rounded-full bg-orange-50 flex items-center justify-center text-orange-500 group-hover:bg-orange-600 group-hover:text-white transition-all shadow-sm">
                                                        <Icon name="ArrowRight" size={20} className="md:w-6 md:h-6" />
                                                    </div>
                                                </div>
                                            </div>
                                        </article>
                                    ))}
                                </div>
                            </div>
                        )}
                    </main>

                    {/* Footer */}
                    <footer className="bg-gray-950 text-gray-400 py-16 md:py-24 px-6 mt-16 md:mt-32 relative overflow-hidden">
                        <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-500 via-pink-500 to-orange-500"></div>
                        <div className="max-w-7xl mx-auto text-center space-y-8 md:space-y-12">
                            <h2 className="text-white text-3xl md:text-6xl font-brand tracking-tighter italic">#RecetasEnUnaPagina</h2>
                            <div className="space-y-2 md:space-y-3">
                                <p className="text-sm md:text-lg font-black uppercase tracking-[0.3em] md:tracking-[0.5em] text-orange-500">Mercedes Recalde</p>
                                <p className="text-[10px] md:text-xs uppercase tracking-[0.2em] md:tracking-[0.3em] text-gray-600 font-medium italic px-4">Tecnica Superior en Gastronom√≠a y Docente certificada</p>
                            </div>
                            <div className="flex justify-center gap-8 md:gap-12 pt-6 md:pt-8">
                                <a href={data.contact.instagram} target="_blank" className="flex flex-col items-center gap-3 md:gap-4 transition-all hover:text-pink-500 group">
                                    <InstagramIcon size={28} className="md:w-9 md:h-9 group-hover:scale-125 transition-transform" /><span className="text-[8px] md:text-[10px] font-black uppercase tracking-widest">Instagram</span>
                                </a>
                                <a href={data.contact.twitter} target="_blank" className="flex flex-col items-center gap-3 md:gap-4 transition-all hover:text-blue-400 text-blue-600 group">
                                    <XSocialIcon size={26} className="md:w-8 md:h-8 group-hover:scale-125 transition-transform" /><span className="text-[8px] md:text-[10px] font-black uppercase tracking-widest">Twitter / X</span>
                                </a>
                            </div>

                            {/* Bloque Cafecito - Editorial */}
                            <div className="pt-12 md:pt-16 space-y-4 text-center max-w-md mx-auto">
                                <p className="text-gray-500 text-xs md:text-sm leading-relaxed">
                                    Este sitio es gratuito y lo seguir√° siendo.<br />
                                    Si cre√©s que este contenido es valioso y quer√©s ayudarme a seguir creciendo, pod√©s invitarme un cafecito.
                                </p>
                                <div className="flex gap-6 justify-center">
                                    <a href={data.contact.instagram} target="_blank" className="text-gray-900 hover:text-orange-600 transition-colors transform hover:scale-110">
                                        <Icon name="Instagram" size={24} />
                                    </a>
                                    <a href={`mailto:${data.contact.email}`} className="text-gray-900 hover:text-orange-600 transition-colors transform hover:scale-110">
                                        <Icon name="Mail" size={24} />
                                    </a>
                                </div>

                                {/* DONATION BUTTONS FOOTER */}
                                <div className="flex flex-col gap-3 items-center w-full max-w-xs mx-auto mt-8 border-t border-orange-100 pt-8">
                                    <p className="text-[9px] uppercase tracking-widest text-gray-400 font-bold mb-2">Apoy√° mi contenido</p>

                                    {/* Opci√≥n Argentina */}
                                    <div className="flex flex-col gap-1 w-full">
                                        <span className="text-[9px] text-gray-400 uppercase tracking-widest font-bold text-center">üá¶üá∑ Desde Argentina</span>
                                        <a href="https://cafecito.app/merbakes" target="_blank" className="bg-orange-500 hover:bg-orange-600 text-white px-5 py-2.5 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all shadow-md hover:-translate-y-0.5 flex items-center justify-center gap-2 w-full">
                                            <Icon name="Coffee" size={14} /> Invitame un Cafecito
                                        </a>
                                    </div>

                                    {/* Opci√≥n Internacional (PayPal) */}
                                    {data.bio?.paypal && (
                                        <div className="flex flex-col gap-1 w-full animate-in fade-in slide-in-from-top-2">
                                            <span className="text-[9px] text-gray-400 uppercase tracking-widest font-bold text-center">üåç Desde el Exterior</span>
                                            <a href={data.bio.paypal} target="_blank" className="bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all shadow-md hover:-translate-y-0.5 flex items-center justify-center gap-2 text-decoration-none w-full">
                                                <Icon name="Globe" size={14} /> Donar con PayPal
                                            </a>
                                        </div>
                                    )}
                                </div>
                            </div>

                            <p className="text-[8px] md:text-[10px] font-bold uppercase tracking-[0.2em] md:tracking-[0.3em] opacity-20 pt-8 md:pt-12 px-4">¬© {new Date().getFullYear()} Mercedes Recalde ¬∑ Schoolinarymer. <span className="ml-2">v2.7</span></p>
                        </div>
                    </footer>

                    {/* Modal Contacto */}
                    {showContact && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-gray-950/95 backdrop-blur-xl animate-in">
                            <div className="bg-white w-full max-w-xl rounded-[3rem] p-8 md:p-14 relative shadow-2xl border-4 border-orange-500">

                                <button
                                    onClick={() => setShowContact(false)}
                                    className="absolute top-6 right-6 p-3 bg-orange-50 hover:bg-orange-500 hover:text-white rounded-full transition-all hover:rotate-90"
                                >
                                    <Icon name="X" size={20} />
                                </button>

                                <h3 className="text-3xl md:text-5xl font-brand text-gray-900 tracking-tighter mb-8 text-center">
                                    Contacto
                                </h3>

                                <form
                                    action="https://api.web3forms.com/submit"
                                    method="POST"
                                    className="space-y-6"
                                >
                                    <input type="hidden" name="access_key" value="d1fbc731-2562-480f-bee9-ea8651e00c23" />

                                    <input
                                        type="text"
                                        name="name"
                                        required
                                        placeholder="Tu nombre"
                                        className="w-full px-6 py-4 rounded-2xl border border-orange-200 focus:outline-none focus:ring-4 focus:ring-orange-500/20"
                                    />

                                    <input
                                        type="email"
                                        name="email"
                                        required
                                        placeholder="Tu email"
                                        className="w-full px-6 py-4 rounded-2xl border border-orange-200 focus:outline-none focus:ring-4 focus:ring-orange-500/20"
                                    />

                                    <textarea
                                        name="message"
                                        required
                                        placeholder="Tu mensaje"
                                        rows="5"
                                        className="w-full px-6 py-4 rounded-2xl border border-orange-200 focus:outline-none focus:ring-4 focus:ring-orange-500/20 resize-none"
                                    ></textarea>

                                    <button
                                        type="submit"
                                        className="w-full bg-orange-600 hover:bg-orange-700 text-white py-4 rounded-2xl font-black uppercase tracking-widest text-xs transition-all"
                                    >
                                        Enviar mensaje
                                    </button>
                                </form>
                            </div>
                        </div>
                    )}

                    {/* Modal Detalle Receta */}
                    {selectedNewsletter && (
                        <NewsletterModal newsletter={selectedNewsletter} onClose={() => setSelectedNewsletter(null)} />
                    )}

                    {selectedTechnique && (
                        <TechniqueModal technique={selectedTechnique} onClose={() => setSelectedTechnique(null)} />
                    )}

                    {selectedRecipe && (
                        <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-gray-950/95 backdrop-blur-xl animate-in">
                            <div className="bg-[#fffaf5] w-full max-w-4xl max-h-[92vh] rounded-3xl overflow-hidden relative shadow-2xl flex flex-col">
                                {/* Bot√≥n cerrar */}
                                <button onClick={() => setSelectedRecipe(null)} className="absolute top-4 right-4 z-10 p-3 bg-white/90 hover:bg-orange-500 hover:text-white rounded-full shadow-xl transition-all hover:rotate-90 print:hidden">
                                    <Icon name="X" size={24} />
                                </button>

                                {/* Contenido scrolleable */}
                                <div className="overflow-y-auto flex-1 no-scrollbar">
                                    {/* Header con imagen */}
                                    <div className="relative print:flex print:flex-col print:items-center">
                                        <img
                                            src={selectedRecipe.coverImage || selectedRecipe.image}
                                            className="w-full h-64 md:h-80 object-cover print:w-48 print:h-48 print:rounded-2xl print:mb-4"
                                            alt={selectedRecipe.title}
                                        />
                                        <div className="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent print:hidden"></div>
                                        <div className="absolute bottom-0 left-0 right-0 p-6 md:p-8 print:relative print:p-0 print:text-center print:text-black">
                                            <span className="bg-orange-500 text-white px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest mb-3 inline-block print:hidden">{selectedRecipe.category}</span>
                                            <h2 className="text-3xl md:text-4xl font-brand text-white leading-tight print:text-orange-600 print:text-2xl">{selectedRecipe.title}</h2>

                                            {/* BOT√ìN T√âCNICA ASOCIADA */}
                                            {selectedRecipe.techniqueId && (
                                                <div
                                                    className="inline-flex items-center gap-2 mt-4 bg-purple-600 text-white px-4 py-2 rounded-xl text-xs font-black uppercase tracking-widest cursor-pointer hover:bg-purple-500 transition-colors shadow-lg animate-bounce print:hidden"
                                                    onClick={(e) => {
                                                        e.stopPropagation();
                                                        const tech = data.techniques.find(t => t.id === selectedRecipe.techniqueId);
                                                        if (tech) setSelectedTechnique(tech);
                                                    }}
                                                >
                                                    <Icon name="GraduationCap" size={16} /> Ver Clase / Historia
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    {/* Barra de Meta Info con iconos */}
                                    <div className="bg-white border-b border-orange-100 px-6 py-4">
                                        <div className="flex flex-wrap items-center justify-center gap-6 text-sm">
                                            <div className="flex items-center gap-2 text-gray-600">
                                                <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center">
                                                    <Icon name="Clock" size={16} className="text-orange-500" />
                                                </div>
                                                <div>
                                                    <span className="text-[10px] uppercase tracking-wider text-gray-400 block">Tiempo</span>
                                                    <span className="font-bold text-gray-800">{selectedRecipe.time || '30 min'}</span>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2 text-gray-600">
                                                <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center">
                                                    <Icon name="Users" size={16} className="text-orange-500" />
                                                </div>
                                                <div>
                                                    <span className="text-[10px] uppercase tracking-wider text-gray-400 block">Porciones</span>
                                                    <span className="font-bold text-gray-800">{selectedRecipe.portions || '8 porciones'}</span>
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-2 text-gray-600">
                                                <div className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center">
                                                    <Icon name="ChefHat" size={16} className="text-orange-500" />
                                                </div>
                                                <div>
                                                    <span className="text-[10px] uppercase tracking-wider text-gray-400 block">Dificultad</span>
                                                    <span className="font-bold text-gray-800">{selectedRecipe.difficulty || 'Media'}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* Botones de acci√≥n */}
                                    <div className="flex justify-center items-center gap-6 p-6 bg-white border-b border-orange-100 print:hidden">
                                        <button
                                            onClick={() => window.print()}
                                            className="flex items-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-3 rounded-full font-bold text-xs transition-all"
                                        >
                                            <Icon name="Printer" size={16} />
                                            Imprimir
                                        </button>

                                        <a
                                            href={`https://wa.me/?text=${encodeURIComponent('Mir√° esta receta de ' + selectedRecipe.title + ' por @MerBakes: ' + window.location.href)}`}
                                            target="_blank"
                                            className="flex items-center gap-2 bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-full font-bold text-xs transition-all shadow-lg shadow-green-200"
                                        >
                                            <Icon name="Share2" size={16} />
                                            Compartir
                                        </a>
                                    </div>

                                    {/* Descripci√≥n */}
                                    {selectedRecipe.description && (
                                        <div className="px-6 md:px-10 py-6 bg-white">
                                            <p className="text-gray-600 text-center italic text-lg leading-relaxed">"{selectedRecipe.description}"</p>
                                        </div>
                                    )}

                                    {/* Tarjeta de Receta estilo Isabel Vermal */}
                                    <div className="mx-4 md:mx-8 my-6 bg-white rounded-2xl border border-orange-100 shadow-sm overflow-hidden">

                                        {/* INGREDIENTES */}
                                        <div className="p-6 md:p-8">
                                            <div className="flex items-center gap-4 mb-6">
                                                <div className="w-10 h-10 rounded-xl bg-orange-500 flex items-center justify-center">
                                                    <Icon name="ShoppingBasket" size={20} className="text-white" />
                                                </div>
                                                <h3 className="text-xl md:text-2xl font-brand text-gray-900 uppercase tracking-wide">Ingredientes</h3>
                                                <div className="flex-1 h-0.5 bg-gradient-to-r from-orange-200 to-transparent"></div>
                                            </div>
                                            <ul className="space-y-3">
                                                {(selectedRecipe.ingredients || []).map((ing, idx) => (
                                                    <li key={idx} className="flex items-start gap-3 text-gray-700">
                                                        <span className="w-2 h-2 rounded-full bg-orange-400 mt-2 shrink-0"></span>
                                                        <span className="text-base leading-relaxed">{ing}</span>
                                                    </li>
                                                ))}
                                            </ul>
                                        </div>

                                        {/* Separador decorativo */}
                                        <div className="h-px bg-gradient-to-r from-transparent via-orange-200 to-transparent mx-8"></div>

                                        {/* PASO A PASO */}
                                        <div className="p-6 md:p-8">
                                            <div className="flex items-center gap-4 mb-6">
                                                <div className="w-10 h-10 rounded-xl bg-orange-500 flex items-center justify-center">
                                                    <Icon name="ListOrdered" size={20} className="text-white" />
                                                </div>
                                                <h3 className="text-xl md:text-2xl font-brand text-gray-900 uppercase tracking-wide">Paso a Paso</h3>
                                                <div className="flex-1 h-0.5 bg-gradient-to-r from-orange-200 to-transparent"></div>
                                            </div>
                                            <ol className="space-y-4">
                                                {(selectedRecipe.instructions || '').split('\n\n').filter(step => step.trim()).map((step, idx) => (
                                                    <li key={idx} className="flex gap-4">
                                                        <span className="w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center text-orange-600 font-bold text-sm shrink-0">{idx + 1}</span>
                                                        <p className="text-gray-700 text-base leading-relaxed pt-1">{step.replace(/^\d+\.\s*/, '')}</p>
                                                    </li>
                                                ))}
                                            </ol>
                                        </div>
                                    </div>

                                    {/* Cafecito al final */}
                                    <div className="p-8 bg-gradient-to-br from-orange-50 to-orange-100 text-center print:hidden flex flex-col items-center">
                                        <p className="text-gray-600 text-lg mb-2">üíõ</p>
                                        <p className="text-gray-700 text-base mb-6">Si esta receta te hizo feliz, pod√©s apoyar mi trabajo con un cafecito. ¬°Gracias por cocinar conmigo!</p>

                                        <div className="flex flex-col gap-3 w-full max-w-xs">
                                            {/* Argentina */}
                                            <a href="https://cafecito.app/schoolinary" target="_blank" className="w-full bg-orange-500 hover:bg-orange-600 text-white px-4 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all shadow-md hover:-translate-y-0.5 flex items-center justify-center gap-2 text-decoration-none">
                                                <Icon name="Coffee" size={16} /> Invitame un Cafecito (AR)
                                            </a>

                                            {/* Internacional */}
                                            {data.bio?.paypal && (
                                                <a href={data.bio.paypal} target="_blank" className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-xl font-black uppercase tracking-widest text-[10px] transition-all shadow-md hover:-translate-y-0.5 flex items-center justify-center gap-2 text-decoration-none">
                                                    <Icon name="Globe" size={16} /> Donar con PayPal (Ext)
                                                </a>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>

    <script>
        // Inicializar Lucide icons
        if (window.lucide) {
            lucide.createIcons();
        }
    </script>

    <script>
        // LIMPIAR Service Workers y caches viejos (fix iOS)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.getRegistrations().then(function(registrations) {
                for (let reg of registrations) {
                    reg.unregister().then(() => console.log('SW eliminado'));
                }
            });
            if ('caches' in window) {
                caches.keys().then(function(names) {
                    for (let name of names) {
                        caches.delete(name).then(() => console.log('Cache eliminado:', name));
                    }
                });
            }
        }
    </script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"2363d88fe17f4226b091751d1e66c5f0","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
<script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"version":"2024.11.0","token":"2363d88fe17f4226b091751d1e66c5f0","r":1,"server_timing":{"name":{"cfCacheStatus":true,"cfEdge":true,"cfExtPri":true,"cfL4":true,"cfOrigin":true,"cfSpeedBrain":true},"location_startswith":null}}' crossorigin="anonymous"></script>
</body>

</html>